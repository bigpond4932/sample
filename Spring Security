Spring Security

로그인 처리를 하는데 사용되는 스프링 프레임 워크의 기능
사용자의 권한, 등급을 기반으로 로그인 체크를 사용
우리는 기본적으로 쿠키를 이용하거나 세션을 이용하는 방식으로 로그인 처리
스프링에서는 + 인터셉터를 이용해서 로그인 처리

인터셉터 vs 필터
필터는 jsp 의 서블릿에서 사용되는 개념
서블릿이 요청을 받아서 처리하기 전에 필요한 동작을 핑터에서 해줬었다.
인코딩 작업, Null 값 작업이라던가, 작업 후에 다음 단계로 요청을 전달
필터는 근본적으로 스프링과 무관한 서블릿의 자원

필터		서블릿 범위
요청 ===>>[ | 필터 | ===> 요청 중간 처리 ==> |서블릿| ]

인터셉터
			서블릿범위		스프링 범위
요청 ===>>> [| 필터 |] ===> [| 인터셉터 |======> |컨트롤러|]]


인터셉터는 스프링의 빈으로 관리되는 필터
인터셉터를 사용하면 스프링 내부에서 관리되는 모든 자원들을 활용할 수 있게 된다.

스프링 시큐리티 라이브러리를 추가하고 (pom.xml 에 dependency)
config, web, core +
스프링 시큐리티 전용 설정파일 (xml)을 root-context.xml이 있는 위치에 추가
스프링 MVC에서 시큐리티 기능을 사용하기 위해서 시큐리티가 서블릿 범위에서 동작하도록
web.xml에 필터로 등록

스프링 시큐리티에서 가장 중요한 개념 두가지
인증 (Authentication), 권한(Authorization)
인증 : 자기 자신을 증명
권한 : 다른 살마이 자격을 부여해준다. 

여러분들이 어떤 회사에 고장난 DB를 고치기 위해서 방문
회사 입구에서 여러분들이 누구인지를 물어본다. " 아 나는 고장난 DB 고치기 위해서 온 엔지니어 홍길동 이다.."
본인 인증 (신분증 검사, 출입증 검사, 방문예약 검사 등등...)

인증 성공 후에 회사 내부에 들어간 홍길동은 다시 데이터 베이스 담당자를 만나서
데이터베이스의 접근 권한 등의 정보를 얻어야 한다. ==> 권한을 부여받아서 데이터베이스를 고친다.

스프링 시큐리티 설정파일 작성할 때 추가했던 AuthentificationManager ==> 얘가 인증을 담당한다.

접근 제한 설정

스프링 시큐리티와 jdbc를 같이 이용하는 방법
1) 스프링 시큐리티에서 지정한 형식으로 테이블을 생성해서 사용
2) 우리가 작성한 데이터베이스를 이용하는 방식

인증 / 권한을 위해 테이블을 생성
tbl_member : 회원정보
tbl_member_auth : 회원의 권한
패스워드를 그냥 그대로 사용했는데, 인코딩까지 해보자
암호화 처리!!

데이터베이스에 저장된 회원정보를 통해 인증을 할 건데 필요한 쿼리 2개
사용자 정보를 인증하는데 필요한 쿼리
그 사용자의 권한을 확인하는데 필요한 쿼리 

if 
id가 admin90인 사용자의 정보를 가져오는 쿼리
id가 admin90인 사용자의 권한을 가져오는 쿼리

security-context(security:jdbc-user-service)에서 쿼리를 우리가 직접 넣어서 로그인 정보를 DB에서 가져오고 확인하는 작업을 했는데,
Mybatis-xml-mapper로 그 역할을 mybatis한테 대신 시켜서 이를 가능하게 했음. 
